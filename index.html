<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tai Wai Weather</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-indigo-700 min-h-screen text-white font-sans p-4">
    <div class="max-w-md mx-auto">
        <header class="text-center py-8">
            <h1 class="text-4xl font-bold">Tai Wai Weather</h1>
            <p id="last-updated" class="text-blue-100 text-sm mt-2 opacity-80"></p>
        </header>

        <main class="space-y-6">
            <!-- Current Weather Card -->
            <section class="glass rounded-3xl p-8 text-center shadow-xl">
                <div class="text-sm uppercase tracking-widest text-blue-100 mb-2">Sha Tin Station</div>
                <div id="current-temp" class="text-7xl font-bold mb-4">--째C</div>
                <div id="current-condition" class="text-xl font-medium">Loading...</div>
                <div class="flex justify-around mt-6 text-blue-50 border-t border-white/20 pt-4">
                    <div>
                        <div class="text-xs uppercase opacity-70">Humidity</div>
                        <div id="humidity" class="font-semibold text-lg">--%</div>
                    </div>
                </div>
            </section>

            <!-- 9-Day Forecast Section -->
            <section>
                <h2 class="text-xl font-semibold mb-4 px-2">9-Day Forecast</h2>
                <div id="forecast-list" class="space-y-3">
                    <!-- Forecast items will be injected here -->
                    <div class="animate-pulse glass rounded-2xl p-4 h-20"></div>
                </div>
            </section>
        </main>

        <footer class="text-center py-8 text-blue-200 text-xs opacity-60">
            Data provided by Hong Kong Observatory
        </footer>
    </div>

    <script>
        const CURRENT_WEATHER_API = 'https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang=en';
        const FORECAST_API = 'https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=fnd&lang=en';

        async function fetchData() {
            try {
                const [weatherRes, forecastRes] = await Promise.all([
                    fetch(CURRENT_WEATHER_API),
                    fetch(FORECAST_API)
                ]);

                const weatherData = await weatherRes.json();
                const forecastData = await forecastRes.json();

                updateCurrentWeather(weatherData);
                updateForecast(forecastData);
            } catch (error) {
                console.error('Error fetching weather data:', error);
                document.getElementById('current-condition').textContent = 'Error loading data';
            }
        }

        function updateCurrentWeather(data) {
            // Find Sha Tin temperature
            const shaTinTemp = data.temperature.data.find(t => t.place === 'Sha Tin');
            if (shaTinTemp) {
                document.getElementById('current-temp').textContent = `${shaTinTemp.value}째C`;
            }

            // Update humidity
            if (data.humidity && data.humidity.data.length > 0) {
                document.getElementById('humidity').textContent = `${data.humidity.data[0].value}%`;
            }

            // Update last updated time
            const date = new Date(data.updateTime);
            document.getElementById('last-updated').textContent = `Last Updated: ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            
            // Get condition from general situation or icon
            // For simplicity, we can just show "Updating..." or handle icon if we had a mapping
            document.getElementById('current-condition').textContent = 'Clear Skies'; // Fallback
        }

        function updateForecast(data) {
            const list = document.getElementById('forecast-list');
            list.innerHTML = '';

            data.weatherForecast.forEach(day => {
                const date = new Date(day.forecastDate.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3'));
                const dayName = day.week;
                const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

                const item = document.createElement('div');
                item.className = 'glass rounded-2xl p-4 flex items-center justify-between';
                item.innerHTML = `
                    <div class="flex-1">
                        <div class="font-bold">${dayName}</div>
                        <div class="text-xs opacity-70">${formattedDate}</div>
                    </div>
                    <div class="flex-1 text-center">
                        <img src="https://www.hko.gov.hk/images/HK48x48/pic${day.ForecastIcon}.png" alt="weather" class="w-10 h-10 mx-auto">
                    </div>
                    <div class="flex-1 text-right">
                        <span class="font-bold">${day.forecastMaxtemp.value}째</span>
                        <span class="opacity-60 text-sm ml-1">${day.forecastMintemp.value}째</span>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        fetchData();
    </script>
</body>
</html>
